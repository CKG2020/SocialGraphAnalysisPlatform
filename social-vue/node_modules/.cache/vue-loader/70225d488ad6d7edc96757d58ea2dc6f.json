{"remainingRequest":"/home/ckg/A毕设/exam-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ckg/A毕设/exam-vue/src/components/user/Chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/ckg/A毕设/exam-vue/src/components/user/Chat.vue","mtime":1649580872948},{"path":"/home/ckg/A毕设/exam-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIGltcG9ydCB7bGlzdE1zZyxzZW5kTXNnIH0gZnJvbSAiQC9hcGkvaW5kZXgiOwpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lOiAiTWVzQm9hcmQiLAogICAgcHJvcHM6IHsKICAgICAgICB2YWx1ZTogewogICAgICAgICAgICB0eXBlOiBCb29sZWFuLAogICAgICAgICAgICBkZWZhdWx0OiBmYWxzZQogICAgICAgIH0KICAgIH0sCiAgICBkYXRhKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNoYXRWaXNpYmxlOnRoaXMudmFsdWUsCiAgICAgICAgICAgIGxvYWRpbmc6ZmFsc2UsCiAgICAgICAgICAgIGRlZnVhbHRBdmF0YXI6cmVxdWlyZSgnLi4vLi4vYXNzZXRzL2xvZ28ucG5nJyksIC8vIOWQjuerr+ayoeaciei/lOWbnuWktOWDj+m7mOiupOWktOWDj++8jOazqOaEj++8mumcgOimgeeUqHJlcXVpcmXor7fmsYLmlrnlvI/miY3og73liqjmgIHorr/pl67mnKzlnLDmlofku7YKICAgICAgICAgICAgZGF0YTpbXSwKICAgICAgICAgICAgZGlzdGluY0RhdGE6W10sIC8vIOa2iOaBr+WOu+mHjeaVsOe7hAogICAgICAgICAgICBvZmZzZXRNYXg6MCwgLy8g5pyA5aSn5YGP56e75L2N77yM6K6w5b2V5b2T5YmN6I635Y+W55qE5pyA5aSnaWTvvIzlvoDlkI7nmoTlrprml7bova7or6LmlbDmja7ml7bmr4/mrKHlj6rojrflj5bmr5Tov5nkuKppZOWkp+eahOaVsOaNrgogICAgICAgICAgICBvZmZzZXRNaW46MCwgIC8vIOacgOWwj+WBj+enu+S9je+8jOiusOW9leW9k+WJjeiOt+WPlueahOacgOWwj2lk77yM5b6A5LiK5ruR5Yqo5pe25q+P5qyh5Y+q6I635Y+W5q+U6L+Z5bCPaWTlpKfnmoTmlbDmja4KICAgICAgICAgICAgc2VhcmNoRm9ybTp7IC8vIOavj+asoeWumuaXtuiOt+WPluaVsOaNruaIlummluasoeWKoOi9veaVsOaNruaPkOS6pOeahGZvcm3ooajljZXmlbDmja4KICAgICAgICAgICAgICAgIHBhZ2VOdW1iZXI6IDEsCiAgICAgICAgICAgICAgICBwYWdlU2l6ZTogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9ybTp7IC8vIOWPkemAgeaVsOaNruaPkOS6pOaVsOaNruihqOWNlQogICAgICAgICAgICAgICAgY29udGVudDoiIiwKICAgICAgICAgICAgICAgIG1zZzoiIgogICAgICAgICAgICB9LAogICAgICAgICAgICB0aW1lclN3aXRjaDowIC8vIOWumuaXtuWZqOW8gOWFs++8jOm7mOiupOWFs+mXrQogICAgICAgIH07CiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIGluaXQoKXsKCiAgICAgICAgfSwKICAgICAgICBsb2FkTXNnKCl7IC8vIOeql+S9k+aJk+W8gOm7mOiupOWKoOi9veS4gOmhteaVsOaNru+8jOeql+S9k+S7gOS5iOWRqOacn+S4reWAvOi/kOihjOS4gOasoQogICAgICAgICAgICBsZXQgdGhhdCA9IHRoaXM7CiAgICAgICAgICAgIHRoaXMuc2VhcmNoRm9ybS5vZmZzZXRNYXggPSB0aGlzLm9mZnNldE1heDsKICAgICAgICAgICAgLy8gbGlzdE1zZyh0aGlzLnNlYXJjaEZvcm0pLnRoZW4ocmVzPT57CiAgICAgICAgICAgIC8vICAgICBpZiAocmVzLmNvZGUgPT0gMjAwKSB7CiAgICAgICAgICAgIC8vICAgICAgICAgcmVzLmRhdGEuZm9yRWFjaChlID0+IHsKICAgICAgICAgICAgLy8gICAgICAgICAgICAgLy8g5qCH6K6w5pyA5aSn5YGP56e75L2NCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGlmKHRoYXQub2Zmc2V0TWF4IDwgZS5tc2dJZCl7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICB0aGF0Lm9mZnNldE1heCA9IGUubXNnSWQ7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gICAgICAgICAgICAgZS5jb250ZW50ID0gSlNPTi5wYXJzZShlLmNvbnRlbnQpOwogICAgICAgICAgICAvLyAgICAgICAgICAgICB0aGF0LmRhdGEudW5zaGlmdChlKQogICAgICAgICAgICAvLyAgICAgICAgICAgICB0aGF0LmRpc3RpbmNEYXRhLnB1c2goZS5tc2dJZCk7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgIC8vIOagh+iusOacgOWkp+WBj+enu+S9je+8jOWQjuerr+i/lOWbnuaVsOaNruaYr+mAhuW6j++8jOaJgOS7peacgOWQjuS4gOadoWlk5pyA5pawCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHRoYXQub2Zmc2V0TWluID0gZS5tc2dJZDsKICAgICAgICAgICAgLy8gICAgICAgICB9KTsKICAgICAgICAgICAgLy8gICAgICAgICAvLyDmlbDmja7liqDovb3lrozmiJDvvIzmu5rliqjmnaHmu5rliqjliLDnqpfkvZPlupXpg6gKICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLnNjcm9sbFRvQm90dG9tKCk7CiAgICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAgIC8vIH0pOwoKCiAgICAgICAgfSwKICAgICAgICBzaG93KCl7IC8vIOaJk+W8gOeql+S9k+WIneWni+WMluaVsOaNrgogICAgICAgICAgICAvLyDliJ3lp4vljJbmlbDmja4KICAgICAgICAgICAgdGhpcy5kYXRhID1bXTsKICAgICAgICAgICAgdGhpcy5kaXN0aW5jRGF0YSA9W107CiAgICAgICAgICAgIHRoaXMub2Zmc2V0TWF4ID0gMDsKICAgICAgICAgICAgdGhpcy5vZmZzZXRNaW4gPSAwOwogICAgICAgICAgICB0aGlzLnNlYXJjaEZvcm0ucGFnZU51bWJlciA9IDE7CiAgICAgICAgICAgIHRoaXMuc2VhcmNoRm9ybS5wYWdlU2l6ZSA9IDIwOwogICAgICAgICAgICB0aGlzLmZvcm0gPXsKICAgICAgICAgICAgICAgIGNvbnRlbnQ6IiIsCiAgICAgICAgICAgICAgICBtc2c6IiIKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5sb2FkTXNnKCk7CiAgICAgICAgICAgIHRoaXMuY2hhdFZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAvLyDlvIDlkK/lrprml7blmagKICAgICAgICAgICAgdGhpcy50aW1lclN3aXRjaCA9IDE7CiAgICAgICAgICAgIHRoaXMucmVsb2FkRGF0YSgpOwogICAgICAgIH0sCiAgICAgICAgc2VuZE1zZygpeyAvLyDlj5HpgIHmtojmga8KICAgICAgICAgICAgaWYoIXRoaXMuZm9ybS5tc2cpewogICAgICAgICAgICAgICAgdGhpcy4kTWVzc2FnZS53YXJuaW5nKCLkuI3og73lj5HpgIHnqbrnmb3kv6Hmga8iKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgY29udGVudCA9IHsgLy8g5bCB6KOF5raI5oGv5L2TCiAgICAgICAgICAgICAgICB0eXBlOiJ0eHQiLAogICAgICAgICAgICAgICAgbXNnOnRoaXMuZm9ybS5tc2cKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5mb3JtLmNvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShjb250ZW50KTsKICAgICAgICAgICAgc2VuZE9yZGVyTXNnKHRoaXMuZm9ybSkudGhlbihyZXM9PnsKICAgICAgICAgICAgICAgIGlmIChyZXMuY29kZSA9PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICByZXMuZGF0YS5jb250ZW50ID0gSlNPTi5wYXJzZShyZXMuZGF0YS5jb250ZW50KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEucHVzaChyZXMuZGF0YSkKICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm0ubXNnPSIiOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzdGluY0RhdGEucHVzaChyZXMuZGF0YS5tc2dJZCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxUb0JvdHRvbSgpOwogICAgICAgICAgICAgICAgICAgIC8vIOWPkemAgeS/oeaBr+WPqui/lOWbnuW9k+WJjeS4gOadoe+8jOatpOaXtuWPr+iDveWvueaWueW3sue7j+WPkemAgeS/oeaBr++8jOaJgOS7peS4jeS/ruaUueWBj+enu+mHjwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHNjcm9sbFRvQm90dG9tKCl7IC8vIOa7muWKqOWIsOeql+S9k+W6lemDqAogICAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKT0+ewogICAgICAgICAgICAgICAgbGV0IGNoYXRmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRmb3JtIik7CiAgICAgICAgICAgICAgICBjaGF0Zm9ybS5zY3JvbGxUb3AgPSBjaGF0Zm9ybS5zY3JvbGxIZWlnaHQ7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgLy8g5rua5Yqo5Yiw5pyA5LiK5pa577yM5Y+W5Y6G5Y+y5pWw5o2u77yM5qC55o2u5YiG6aG15Y+C5pWw5Y+W44CC5LiN55So5L+u5pS55YGP56e75qCH6K6w5L2N77yM5L2G5piv6ZyA6KaB5Yik6YeNCiAgICAgICAgc2Nyb2xsKCl7CiAgICAgICAgICAgIGxldCBjaGF0Zm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0Zm9ybSIpOwogICAgICAgICAgICBsZXQgc2Nyb2xsVG9wID0gY2hhdGZvcm0uc2Nyb2xsVG9wOwogICAgICAgICAgICBpZihzY3JvbGxUb3AgPT0gMCl7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPXRydWU7CiAgICAgICAgICAgICAgICBsZXQgdGhhdCA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaEZvcm0ub2Zmc2V0TWluID0gdGhpcy5vZmZzZXRNaW47CiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaEZvcm0ub2Zmc2V0TWF4ID0gIiI7CiAgICAgICAgICAgICAgICBsaXN0TXNnQnlPcmRlcih0aGlzLnNlYXJjaEZvcm0pLnRoZW4ocmVzPT57CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID1mYWxzZTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmNvZGUgPT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5kYXRhLmZvckVhY2goZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0aGF0LmRpc3RpbmNEYXRhLmluZGV4T2YoZS5tc2dJZCkgPDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuY29udGVudCA9IEpTT04ucGFyc2UoZS5jb250ZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmRhdGEudW5zaGlmdChlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmRpc3RpbmNEYXRhLnB1c2goZS5tc2dJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5L+u5pS55pyA5bCP5YGP56e75L2NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhhdC5vZmZzZXRNaW4gPiBlLm1zZ0lkKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5vZmZzZXRNaW4gPSBlLm1zZ0lkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlbG9hZERhdGEoKXsKICAgICAgICAgICAgLy8g5Yik5pat5a6a5pe25Zmo5byA5YWz5piv5ZCm5byA5ZCv77yM5aaC5p6c5byA5ZCv77yM5YiZ5omn6KGM5a6a5pe25ZmoCiAgICAgICAgICAgIGlmKHRoaXMudGltZXJTd2l0Y2gpewogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHBhcmFtcyA9IHt9OwogICAgICAgICAgICAgICAgICAgIHBhcmFtcy5wYWdlTnVtYmVyID0gMTsKICAgICAgICAgICAgICAgICAgICBwYXJhbXMucGFnZVNpemUgPSAyMDsKICAgICAgICAgICAgICAgICAgICBwYXJhbXMub2Zmc2V0TWF4ID0gdGhpcy5vZmZzZXRNYXg7CiAgICAgICAgICAgICAgICAgICAgbGV0IHRoYXQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIGxpc3RNc2dCeU9yZGVyKHBhcmFtcykudGhlbihyZXM9PnsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5jb2RlID09IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLmRhdGEuZm9yRWFjaChlID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDkv67mlLnmnIDlpKflgY/np7vkvY3vvIzmlL7liLDmoKHpqozph43lpI3kuYvliY3vvIzpmLLmraLlvZPliY3lj5HpgIHkv6Hmga/lt7Lnu4/mlL7lhaXmtojmga/liJfooajvvIzkvYbmmK/lgY/np7vlgLzmsqHor6XnmoTmg4XlhrUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0aGF0Lm9mZnNldE1heCA8IGUubXNnSWQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Lm9mZnNldE1heCA9IGUubXNnSWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoYXQuZGlzdGluY0RhdGEuaW5kZXhPZihlLm1zZ0lkKSA8MCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuY29udGVudCA9IEpTT04ucGFyc2UoZS5jb250ZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5kYXRhLnB1c2goZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5kaXN0aW5jRGF0YS5wdXNoKGUubXNnSWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDmlLbliLDmlrDmtojmga/vvIzliKTmlq3pq5jluqbvvIzlpoLmnpzlvZPliY3mu5rliqjmnaHpq5jluqbot53lupXpg6jlsI/kuo4xMDDvvIzliJnliqjmu5HliLDlupXpg6gKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNoYXRmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRmb3JtIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBnYXAgPSBjaGF0Zm9ybS5zY3JvbGxIZWlnaHQgLWNoYXRmb3JtLnNjcm9sbFRvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZ2FwID4wICYmIGdhcCA8IDQwMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbFRvQm90dG9tKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQucmVsb2FkRGF0YSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LDEwMDAqMik7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgICAgICBjYW5jZWwoKXsgLy8g5YWz6Zet56qX5L2T6ZyA6KaB5oqK5o+Q56S65Lu75Yqh5byA5YWz5LiA6LW35YWz6Zet6LCDCiAgICAgICAgICAgIHRoaXMuY2hhdFZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy50aW1lclN3aXRjaCA9IDA7CiAgICAgICAgfQogICAgfSwKICAgIG1vdW50ZWQoKSB7CiAgICB9Cn07Cg=="},{"version":3,"sources":["Chat.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Chat.vue","sourceRoot":"src/components/user","sourcesContent":["<template>\n    <div>\n        聊天室\n    </div>\n\n    <Modal title=\"在线沟通\" v-model=\"chatVisible\"\n           draggable\n           footer-hide\n           :width=\"580\" @on-cancel=\"cancel\">\n      <div class=\"chat\">\n        <div  class=\"chat-message-body\" id =\"chatform\" @scroll=\"scroll\"\n        >\n          <Spin v-if=\"loading\">\n            <Icon type=\"ios-loading\" size=18 class=\"spin-icon-load\"></Icon>\n          </Spin>\n          <div  dis-hover v-for=\"(item,index) in data\"\n                :key=\"index\" class=\"message-card\">\n            <div :class=\"item.isOneself == 1?'message-row-right': 'message-row-left'\">\n              <img :src=\"item.avatar?item.avatar:defualtAvatar\"\n                   height=\"35\" width=\"35\" >\n              <div class=\"message-content\">\n                <div :style=\"item.isOneself == 1?'text-align:right;display: flex;flex-direction:row-reverse':''\">\n                  {{item.nickName}}\n                  <span class=\"message-time\">\n                   {{item.createTime}}</span>\n                </div>\n                <div class=\"message-body\">\n                  {{item.content.msg}}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <Input\n          v-model=\"form.msg\"\n          type=\"textarea\"\n          style=\"margin:10px 0;\"\n          placeholder=\"主动一点，世界会更大！\"\n          :rows=\"4\"\n        />\n      </div>\n      <div class=\"footer-btn\">\n        <Button @click=\"cancel\" type=\"text\">取消</Button>\n        <Button type=\"primary\" @click=\"sendMsg\">发送</Button>\n      </div>\n    </Modal>\n\n</template>\n<script>\n    // import {listMsg,sendMsg } from \"@/api/index\";\n    export default {\n        name: \"MesBoard\",\n        props: {\n            value: {\n                type: Boolean,\n                default: false\n            }\n        },\n        data() {\n            return {\n                chatVisible:this.value,\n                loading:false,\n                defualtAvatar:require('../../assets/logo.png'), // 后端没有返回头像默认头像，注意：需要用require请求方式才能动态访问本地文件\n                data:[],\n                distincData:[], // 消息去重数组\n                offsetMax:0, // 最大偏移位，记录当前获取的最大id，往后的定时轮询数据时每次只获取比这个id大的数据\n                offsetMin:0,  // 最小偏移位，记录当前获取的最小id，往上滑动时每次只获取比这小id大的数据\n                searchForm:{ // 每次定时获取数据或首次加载数据提交的form表单数据\n                    pageNumber: 1,\n                    pageSize: 20\n                },\n                form:{ // 发送数据提交数据表单\n                    content:\"\",\n                    msg:\"\"\n                },\n                timerSwitch:0 // 定时器开关，默认关闭\n            };\n        },\n        methods: {\n            init(){\n\n            },\n            loadMsg(){ // 窗体打开默认加载一页数据，窗体什么周期中值运行一次\n                let that = this;\n                this.searchForm.offsetMax = this.offsetMax;\n                // listMsg(this.searchForm).then(res=>{\n                //     if (res.code == 200) {\n                //         res.data.forEach(e => {\n                //             // 标记最大偏移位\n                //             if(that.offsetMax < e.msgId){\n                //                 that.offsetMax = e.msgId;\n                //             }\n                //             e.content = JSON.parse(e.content);\n                //             that.data.unshift(e)\n                //             that.distincData.push(e.msgId);\n                //             // 标记最大偏移位，后端返回数据是逆序，所以最后一条id最新\n                //             that.offsetMin = e.msgId;\n                //         });\n                //         // 数据加载完成，滚动条滚动到窗体底部\n                //         this.scrollToBottom();\n                //     }\n                // });\n\n\n            },\n            show(){ // 打开窗体初始化数据\n                // 初始化数据\n                this.data =[];\n                this.distincData =[];\n                this.offsetMax = 0;\n                this.offsetMin = 0;\n                this.searchForm.pageNumber = 1;\n                this.searchForm.pageSize = 20;\n                this.form ={\n                    content:\"\",\n                    msg:\"\"\n                };\n                this.loadMsg();\n                this.chatVisible = true;\n                // 开启定时器\n                this.timerSwitch = 1;\n                this.reloadData();\n            },\n            sendMsg(){ // 发送消息\n                if(!this.form.msg){\n                    this.$Message.warning(\"不能发送空白信息\");\n                    return;\n                }\n                let content = { // 封装消息体\n                    type:\"txt\",\n                    msg:this.form.msg\n                };\n                this.form.content = JSON.stringify(content);\n                sendOrderMsg(this.form).then(res=>{\n                    if (res.code == 200) {\n                        res.data.content = JSON.parse(res.data.content);\n                        this.data.push(res.data)\n                        this.form.msg=\"\";\n                        this.distincData.push(res.data.msgId);\n                        this.scrollToBottom();\n                        // 发送信息只返回当前一条，此时可能对方已经发送信息，所以不修改偏移量\n                    }\n                });\n            },\n            scrollToBottom(){ // 滚动到窗体底部\n                this.$nextTick(()=>{\n                    let chatform = document.getElementById(\"chatform\");\n                    chatform.scrollTop = chatform.scrollHeight;\n                });\n            },\n            // 滚动到最上方，取历史数据，根据分页参数取。不用修改偏移标记位，但是需要判重\n            scroll(){\n                let chatform = document.getElementById(\"chatform\");\n                let scrollTop = chatform.scrollTop;\n                if(scrollTop == 0){\n                    this.loading =true;\n                    let that = this;\n                    this.searchForm.offsetMin = this.offsetMin;\n                    this.searchForm.offsetMax = \"\";\n                    listMsgByOrder(this.searchForm).then(res=>{\n                        this.loading =false;\n                        if (res.code == 200) {\n                            res.data.forEach(e => {\n                                if(that.distincData.indexOf(e.msgId) <0){\n                                    e.content = JSON.parse(e.content);\n                                    that.data.unshift(e);\n                                    that.distincData.push(e.msgId);\n                                    // 修改最小偏移位\n                                    if(that.offsetMin > e.msgId){\n                                        that.offsetMin = e.msgId;\n                                    }\n                                }\n                            });\n                        }\n                    });\n                }\n            },\n            reloadData(){\n                // 判断定时器开关是否开启，如果开启，则执行定时器\n                if(this.timerSwitch){\n                    setTimeout(() => {\n                        let params = {};\n                        params.pageNumber = 1;\n                        params.pageSize = 20;\n                        params.offsetMax = this.offsetMax;\n                        let that = this;\n                        listMsgByOrder(params).then(res=>{\n                            if (res.code == 200) {\n                                res.data.forEach(e => {\n                                    // 修改最大偏移位，放到校验重复之前，防止当前发送信息已经放入消息列表，但是偏移值没该的情况\n                                    if(that.offsetMax < e.msgId){\n                                        that.offsetMax = e.msgId;\n                                    }\n                                    if(that.distincData.indexOf(e.msgId) <0){\n                                        e.content = JSON.parse(e.content);\n                                        that.data.push(e)\n                                        that.distincData.push(e.msgId);\n                                        // 收到新消息，判断高度，如果当前滚动条高度距底部小于100，则动滑到底部\n                                        let chatform = document.getElementById(\"chatform\");\n                                        let gap = chatform.scrollHeight -chatform.scrollTop;\n                                        if(gap >0 && gap < 400){\n                                            this.scrollToBottom();\n                                        }\n                                    }\n                                });\n                                that.reloadData();\n                            }\n                        });\n                    },1000*2);\n                }\n\n            },\n            cancel(){ // 关闭窗体需要把提示任务开关一起关闭调\n                this.chatVisible = false;\n                this.timerSwitch = 0;\n            }\n        },\n        mounted() {\n        }\n    };\n</script>\n\n\n<style scoped>\n  .message {\n    height: 350px;\n  }\n  .ivu-card-body {\n    padding:5px;\n  }\n  .ivu-modal-body{\n    padding: 0px 16px 16px  16px;\n  }\n  .chat-message-body {\n    background-color:#F8F8F6;\n    width:545px;\n    height: 350px;\n    overflow: auto;\n  }\n  .message-card {\n    margin:5px;\n  }\n  .message-row-left {\n    display: flex;\n    flex-direction:row;\n  }\n  .message-row-right {\n    display: flex;\n    flex-direction:row-reverse;\n  }\n  .message-content {\n    margin:-5px 5px 5px 5px;\n    display: flex;\n    flex-direction:column;\n  }\n  .message-body {\n    border:1px solid #D9DAD9;\n    padding:5px;\n    border-radius:3px;\n    background-color:#FFF;\n  }\n  .message-time {\n    margin:0 5px;\n    font-size:5px;\n    color:#D9DAD9;\n  }\n  .footer-btn {\n    float:right;\n    margin-bottom: 5px;\n  }\n  .spin-icon-load {\n    animation:ani-spin 1s linear infinite;\n  }\n  @keyframes ani-spin{\n    form{transform: rotate(0deg);}\n    50% {transform: rotate(180deg);}\n    to  {transform: rotate(360deg);}\n  }\n</style>\n"]}]}
{"remainingRequest":"/home/ckg/A毕设/exam-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ckg/A毕设/exam-vue/src/components/admin/WatchChat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/ckg/A毕设/exam-vue/src/components/admin/WatchChat.vue","mtime":1650087897210},{"path":"/home/ckg/A毕设/exam-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBleGFtIGZyb20gIi4uLy4uL2FwaS9leGFtIjsKCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJXYXRjaENoYXQiLAogICAgZGF0YSgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvbmxpbmU6IDAsCiAgICAgICAgICAgIHdlYnNvY2tldDogdW5kZWZpbmVkLAogICAgICAgICAgICBuYW1lOiAnJywKICAgICAgICAgICAgc2hvd01lc3NhZ2U6JycsCiAgICAgICAgICAgIGZvcm06IHttZXNzYWdlOiAnJ30sCgogICAgICAgICAgICBtZXNzYWdlRm9ybWF0OnsKICAgICAgICAgICAgICAgIHVzZXJJZDonMTYyOTkwMzEzOTEyMicsCiAgICAgICAgICAgICAgICB1c2VyTmFtZTonJywKICAgICAgICAgICAgICAgIG1zZzonJwogICAgICAgICAgICB9LAoKCiAgICAgICAgICAgIG1lc3NhZ2VMaXN0OltdCgogICAgICAgIH0KICAgIH0sCiAgICB1cGRhdGVkKCkgewogICAgICAgIHRoaXMuc2Nyb2xsKCkKICAgIH0sCiAgICBtb3VudGVkKCkgewogICAgICAgIHRoaXMuaW5pdCgpOwogICAgICAgIHRoaXMuJHJlZnMubG9hZGVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICB9LAogICAgY3JlYXRlZCgpIHsKICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgX21lc3NhZ2UobWVzc2FnZSwgdHlwZSkgewogICAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgICAgICAgICAgICB0eXBlOiB0eXBlCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBfbm90aWZ5KHRpdGxlLCBtZXNzYWdlLCB0eXBlKSB7CiAgICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLAogICAgICAgICAgICAgICAgdHlwZTogdHlwZQogICAgICAgICAgICB9KTsKICAgICAgICB9LAoKCiAgICAgICAgaW5pdCgpIHsKCgogICAgICAgICAgICB0aGlzLmluaXRVc2VyKCk7CgoKICAgICAgICAgICAgdGhpcy5pbml0V2ViU29ja2V0KCk7CiAgICAgICAgfSwKCiAgICAgICAgaW5pdFVzZXIoKSB7CgogICAgICAgICAgICBleGFtLmdldFVzZXJBY2NvdW50KCkudGhlbigKICAgICAgICAgICAgICAgIHJlc3BvbnNlPT57CiAgICAgICAgICAgICAgICAgICAgdGhpcy5uYW1lPXJlc3BvbnNlLmRhdGEub2JqCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKCiAgICAgICAgfSwKCiAgICAgICAgaW5pdFdlYlNvY2tldCgpIHsKICAgICAgICAgICAgbGV0ICR0aGlzID0gdGhpczsKICAgICAgICAgICAgLy8gdGhpcy53ZWJzb2NrZXQgPSBuZXcgV2ViU29ja2V0KGFwaS53ZWJzb2NrZXQodGhpcy5mb3JtLmlkKSkKICAgICAgICAgICAgdGhpcy53ZWJzb2NrZXQgPSBuZXcgV2ViU29ja2V0KCJ3czovL2xvY2FsaG9zdDo4ODg5L3dlYnNvY2tldCIpOwoKICAgICAgICAgICAgLy/pk77mjqXlj5HpgIHplJnor6/ml7bosIPnlKgKICAgICAgICAgICAgdGhpcy53ZWJzb2NrZXQub25lcnJvciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICR0aGlzLl9ub3RpZnkoJ+aPkOmGkicsICdXZWJTb2NrZXTpk77mjqXplJnor68nLCAnZXJyb3InKQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8v6ZO+5o6l5oiQ5Yqf5pe26LCD55SoCiAgICAgICAgICAgIHRoaXMud2Vic29ja2V0Lm9ub3BlbiA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgJHRoaXMuX25vdGlmeSgn5o+Q6YaSJywgJ1dlYlNvY2tldOmTvuaOpeaIkOWKnycsICdzdWNjZXNzJykKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy/mjqXmlLbliLDmtojmga/ml7blm57osIMKICAgICAgICAgICAgdGhpcy53ZWJzb2NrZXQub25tZXNzYWdlID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAvLyAgICAgbGV0IGVudGl0eSA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7CiAgICAgICAgICAgICAgICAvLyAgICAgdmFyIG15RGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgICAvLyAgICAgY29uc29sZS5sb2coInh4eHh4eHh4eHh4IitteURhdGUudG9Mb2NhbGVTdHJpbmcoKSkKICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLnRpbWU9bXlEYXRlLnRvTG9jYWxlU3RyaW5nKCkKICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLmZyb21fbmFtZT1lbnRpdHkudXNlck5hbWUKICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLm1lc3NhZ2U9ZW50aXR5Lm1zZwogICAgICAgICAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKCI9PT09PT09PT09PT09PT09PT0iKQogICAgICAgICAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKHRoaXMudGltZSkKICAgICAgICAgICAgICAgIC8vICAgICBjb25zb2xlLmxvZyh0aGlzLmZyb21fbmFtZSkKICAgICAgICAgICAgICAgIC8vICAgICBjb25zb2xlLmxvZyh0aGlzLm1lc3NhZ2UpCiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSkKICAgICAgICAgICAgICAgIGlmKGRhdGEudXNlck5hbWUpewogICAgICAgICAgICAgICAgICAgICR0aGlzLm1lc3NhZ2VMaXN0LnB1c2goZGF0YSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMub25saW5lPWRhdGEKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygieHh4eHh4eHh4eHh4eHh4eHh4enp6enp6eiIrZGF0YSkKICAgICAgICAgICAgICAgICAgICAkdGhpcy5fbm90aWZ5KCfmj5DphpInLCAn5b2T5YmN5Zyo57q/5Lq65pWwOicrZGF0YSwnaW5mbycgKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMuc2Nyb2xsKCkKICAgICAgICAgICAgfQogICAgICAgICAgICAvL+mTvuaOpeWFs+mXreaXtuiwg+eUqAogICAgICAgICAgICB0aGlzLndlYnNvY2tldC5vbmNsb3NlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJHRoaXMuX25vdGlmeSgn5o+Q6YaSJywgJ1dlYlNvY2tldOmTvuaOpeWFs+mXrScsICdpbmZvJykKICAgICAgICAgICAgfQoKICAgICAgICB9LAoKICAgICAgICAvL+aOqOmAgea2iOaBrwogICAgICAgIHNlbmQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmZvcm0ubWVzc2FnZSA9PSBudWxsIHx8IHRoaXMuZm9ybS5tZXNzYWdlLnRyaW0oKSA9PSAnJykgewogICAgICAgICAgICAgICAgdGhpcy5fbWVzc2FnZSgn6K+36L6T5YWl5raI5oGv5YaF5a65JywgJ3dhcm5pbmcnKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdmFyIG15RGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VGb3JtYXQudXNlcklkPW15RGF0ZS50b0xvY2FsZVN0cmluZygpCiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VGb3JtYXQudXNlck5hbWU9dGhpcy5uYW1lCiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VGb3JtYXQubXNnPXRoaXMuZm9ybS5tZXNzYWdlCgogICAgICAgICAgICAgICAgbGV0IHNlbmRNZXNzYWdlPSBKU09OLnN0cmluZ2lmeSh0aGlzLm1lc3NhZ2VGb3JtYXQpCiAgICAgICAgICAgICAgICB0aGlzLndlYnNvY2tldC5zZW5kKHNlbmRNZXNzYWdlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuZm9ybS5tZXNzYWdlPScnCiAgICAgICAgICAgIHRoaXMuc2Nyb2xsKCkKICAgICAgICB9LAoKICAgICAgICAvL+a4heepuua2iOaBrwogICAgICAgIGNsZWFuKCkgewogICAgICAgICAgICB0aGlzLmZvcm0ubWVzc2FnZSA9ICcnCiAgICAgICAgfSwKICAgICAgICAvL+WIh+aNoumAieaLqeeql+WPowogICAgICAgIHNlbGVjdFdpbmRvdyhpZCkgewogICAgICAgICAgICB0aGlzLmN1cnJlbnRfd2luZG93X2lkID0gaWQ7CiAgICAgICAgICAgIGlmICghdGhpcy5jdXJyZW50X3dpbmRvd19pZCkgewogICAgICAgICAgICAgICAgdGhpcy5pbml0Q29tbW9uTWVzc2FnZSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5pbml0U2VsZk1lc3NhZ2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8v56qX5Y+j5rua5YqoCiAgICAgICAgc2Nyb2xsKCkgewogICAgICAgICAgICBsZXQgYm94ID0gdGhpcy4kcmVmcy5ib3gKICAgICAgICAgICAgLy8gYm94LnNjcm9sbFRvcCA9IDEwMDAwMDAwCiAgICAgICAgfSwKCiAgICB9Cn0K"},{"version":3,"sources":["WatchChat.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;;AAGA;;;AAGA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"WatchChat.vue","sourceRoot":"src/components/admin","sourcesContent":["<template>\n  <div id=\"app\">\n    <div class=\"page-loader\" ref=\"loader\">\n      <div class=\"page-loader__spinner\">\n        <svg viewBox=\"25 25 50 50\">\n          <circle cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-width=\"2\" stroke-miterlimit=\"10\"/>\n        </svg>\n      </div>\n    </div>\n    <div class=\"sidebar\">\n      <div class=\"card\">\n        <header>\n          <p class=\"name\">admin监控群聊</p>\n        </header>\n      </div>\n      <div class=\"list\">\n        <ul>\n          <li>\n            <img class=\"avatar\" width=\"30\" height=\"30\" src=\"../../assets/imgs/group.png\">\n            <p class=\"name\">系统群聊</p>\n          </li>\n        </ul>\n      </div>\n    </div>\n    <div class=\"main\">\n      <div class=\"message\" ref=\"box\">\n        <ul>\n          <li v-for=\"(item,key) in messageList\" :id=\"key == (messageList.length - 1) ? 'end' : ''\">\n            <p class=\"time\">\n              <span>{{item.userId}}</span>\n            </p>\n            <div >\n              <span class=\"main-name\">来自:{{item.userName}}</span>\n              <div class=\"text\">{{item.msg}}</div>\n            </div>\n          </li>\n        </ul>\n      </div>\n<!--      <div class=\"text\">-->\n<!--        <el-input-->\n<!--          v-model=\"form.message\" @keyup.native.enter=\"send\"-->\n<!--          type=\"textarea\" :rows=\"5\" placeholder=\"请输入内容，按 Enter 键发送\">-->\n<!--        </el-input>-->\n<!--        <div class=\"btn\">-->\n<!--          <el-button @click=\"clean\" size=\"mini\" type=\"danger\">清空</el-button>-->\n<!--          <el-button @click=\"send\" size=\"mini\" icon=\"el-icon-position\" type=\"success\">发送</el-button>-->\n<!--        </div>-->\n<!--      </div>-->\n    </div>\n  </div>\n</template>\n\n<script>\n    import exam from \"../../api/exam\";\n\n    export default {\n        name: \"WatchChat\",\n        data() {\n            return {\n                online: 0,\n                websocket: undefined,\n                name: '',\n                showMessage:'',\n                form: {message: ''},\n\n                messageFormat:{\n                    userId:'1629903139122',\n                    userName:'',\n                    msg:''\n                },\n\n\n                messageList:[]\n\n            }\n        },\n        updated() {\n            this.scroll()\n        },\n        mounted() {\n            this.init();\n            this.$refs.loader.style.display = 'none';\n        },\n        created() {\n        },\n        methods: {\n            _message(message, type) {\n                this.$message({\n                    message: message,\n                    type: type\n                })\n            },\n            _notify(title, message, type) {\n                this.$notify({\n                    title: title,\n                    message: message,\n                    type: type\n                });\n            },\n\n\n            init() {\n\n\n                this.initUser();\n\n\n                this.initWebSocket();\n            },\n\n            initUser() {\n\n                exam.getUserAccount().then(\n                    response=>{\n                        this.name=response.data.obj\n                    }\n                )\n\n            },\n\n            initWebSocket() {\n                let $this = this;\n                // this.websocket = new WebSocket(api.websocket(this.form.id))\n                this.websocket = new WebSocket(\"ws://localhost:8889/websocket\");\n\n                //链接发送错误时调用\n                this.websocket.onerror = function () {\n                    $this._notify('提醒', 'WebSocket链接错误', 'error')\n                }\n                //链接成功时调用\n                this.websocket.onopen = function (event) {\n                    $this._notify('提醒', 'WebSocket链接成功', 'success')\n                }\n\n                //接收到消息时回调\n                this.websocket.onmessage = function (event) {\n                    //     let entity = JSON.parse(event.data);\n                    //     var myDate = new Date();\n                    //     console.log(\"xxxxxxxxxxx\"+myDate.toLocaleString())\n                    //     this.time=myDate.toLocaleString()\n                    //     this.from_name=entity.userName\n                    //     this.message=entity.msg\n                    //     console.log(\"==================\")\n                    //     console.log(this.time)\n                    //     console.log(this.from_name)\n                    //     console.log(this.message)\n                    let data = JSON.parse(event.data)\n                    if(data.userName){\n                        $this.messageList.push(data)\n                    }\n                    else {\n                        this.online=data\n                        console.log(\"xxxxxxxxxxxxxxxxxxzzzzzzz\"+data)\n                        $this._notify('提醒', '当前在线人数:'+data,'info' )\n                    }\n                    $this.scroll()\n                }\n                //链接关闭时调用\n                this.websocket.onclose = function () {\n                    $this._notify('提醒', 'WebSocket链接关闭', 'info')\n                }\n\n            },\n\n            //推送消息\n            send() {\n                if (this.form.message == null || this.form.message.trim() == '') {\n                    this._message('请输入消息内容', 'warning')\n                    return;\n                }\n                else {\n                    var myDate = new Date();\n                    this.messageFormat.userId=myDate.toLocaleString()\n                    this.messageFormat.userName=this.name\n                    this.messageFormat.msg=this.form.message\n\n                    let sendMessage= JSON.stringify(this.messageFormat)\n                    this.websocket.send(sendMessage)\n                }\n                this.form.message=''\n                this.scroll()\n            },\n\n            //清空消息\n            clean() {\n                this.form.message = ''\n            },\n            //切换选择窗口\n            selectWindow(id) {\n                this.current_window_id = id;\n                if (!this.current_window_id) {\n                    this.initCommonMessage();\n                } else {\n                    this.initSelfMessage();\n                }\n            },\n\n            //窗口滚动\n            scroll() {\n                let box = this.$refs.box\n                // box.scrollTop = 10000000\n            },\n\n        }\n    }\n</script>\n\n<style scoped lang=\"css\">\n  @import \"../../assets/css/chat/main.css\";\n</style>\n"]}]}
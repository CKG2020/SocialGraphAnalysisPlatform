{"remainingRequest":"/home/ckg/A毕设/exam-vue/node_modules/babel-loader/lib/index.js!/home/ckg/A毕设/exam-vue/node_modules/cache-loader/dist/cjs.js??ref--1-0!/home/ckg/A毕设/exam-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ckg/A毕设/exam-vue/src/components/user/Chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/ckg/A毕设/exam-vue/src/components/user/Chat.vue","mtime":1650336982034},{"path":"/home/ckg/A毕设/exam-vue/babel.config.js","mtime":1648737495000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuanNvbi5zdHJpbmdpZnkuanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgZXhhbSBmcm9tICIuLi8uLi9hcGkvZXhhbSI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiQ2hhdCIsCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG9ubGluZTogMCwKICAgICAgd2Vic29ja2V0OiB1bmRlZmluZWQsCiAgICAgIG5hbWU6ICcnLAogICAgICBzaG93TWVzc2FnZTogJycsCiAgICAgIGZvcm06IHsKICAgICAgICBtZXNzYWdlOiAnJwogICAgICB9LAogICAgICBtZXNzYWdlRm9ybWF0OiB7CiAgICAgICAgdXNlcklkOiAnMTYyOTkwMzEzOTEyMicsCiAgICAgICAgdXNlck5hbWU6ICcnLAogICAgICAgIG1zZzogJycKICAgICAgfSwKICAgICAgbWVzc2FnZUxpc3Q6IFtdLAogICAgICB3czogIiIKICAgIH07CiAgfSwKICB1cGRhdGVkOiBmdW5jdGlvbiB1cGRhdGVkKCkgewogICAgdGhpcy5zY3JvbGwoKTsKICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB0aGlzLiRyZWZzLmxvYWRlci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgIHRoaXMuaW5pdCgpOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiBfdGhpczIuY2xvc2VXZWJzb2NrZXQoZSk7CiAgICB9KTsKICB9LAogIG1ldGhvZHM6IHsKICAgIF9tZXNzYWdlOiBmdW5jdGlvbiBfbWVzc2FnZShtZXNzYWdlLCB0eXBlKSB7CiAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgICAgdHlwZTogdHlwZQogICAgICB9KTsKICAgIH0sCiAgICBfbm90aWZ5OiBmdW5jdGlvbiBfbm90aWZ5KHRpdGxlLCBtZXNzYWdlLCB0eXBlKSB7CiAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgICAgdHlwZTogdHlwZQogICAgICB9KTsKICAgIH0sCiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgewogICAgICB0aGlzLmluaXRVc2VyKCk7CiAgICAgIHRoaXMuaW5pdFdlYlNvY2tldCgpOwogICAgfSwKICAgIGluaXRVc2VyOiBmdW5jdGlvbiBpbml0VXNlcigpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICBleGFtLmdldFVzZXJBY2NvdW50KCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczMubmFtZSA9IHJlc3BvbnNlLmRhdGEub2JqOwogICAgICB9KTsKICAgIH0sCiAgICBpbml0V2ViU29ja2V0OiBmdW5jdGlvbiBpbml0V2ViU29ja2V0KCkgewogICAgICB2YXIgJHRoaXMgPSB0aGlzOyAvLyB0aGlzLndlYnNvY2tldCA9IG5ldyBXZWJTb2NrZXQoYXBpLndlYnNvY2tldCh0aGlzLmZvcm0uaWQpKQoKICAgICAgdGhpcy53ZWJzb2NrZXQgPSBuZXcgV2ViU29ja2V0KCJ3czovL2xvY2FsaG9zdDo4ODg5L3dlYnNvY2tldCIpOyAvL+mTvuaOpeWPkemAgemUmeivr+aXtuiwg+eUqAoKICAgICAgdGhpcy53ZWJzb2NrZXQub25lcnJvciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkdGhpcy5fbm90aWZ5KCfmj5DphpInLCAnV2ViU29ja2V06ZO+5o6l6ZSZ6K+vJywgJ2Vycm9yJyk7CiAgICAgIH07IC8v6ZO+5o6l5oiQ5Yqf5pe26LCD55SoCgoKICAgICAgdGhpcy53ZWJzb2NrZXQub25vcGVuID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgJHRoaXMuX25vdGlmeSgn5o+Q6YaSJywgJ1dlYlNvY2tldOmTvuaOpeaIkOWKnycsICdzdWNjZXNzJyk7CiAgICAgIH07IC8v5o6l5pS25Yiw5raI5oGv5pe25Zue6LCDCgoKICAgICAgdGhpcy53ZWJzb2NrZXQub25tZXNzYWdlID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgLy8gICAgIGxldCBlbnRpdHkgPSBKU09OLnBhcnNlKGV2ZW50LmRhdGEpOwogICAgICAgIC8vICAgICB2YXIgbXlEYXRlID0gbmV3IERhdGUoKTsKICAgICAgICAvLyAgICAgY29uc29sZS5sb2coInh4eHh4eHh4eHh4IitteURhdGUudG9Mb2NhbGVTdHJpbmcoKSkKICAgICAgICAvLyAgICAgdGhpcy50aW1lPW15RGF0ZS50b0xvY2FsZVN0cmluZygpCiAgICAgICAgLy8gICAgIHRoaXMuZnJvbV9uYW1lPWVudGl0eS51c2VyTmFtZQogICAgICAgIC8vICAgICB0aGlzLm1lc3NhZ2U9ZW50aXR5Lm1zZwogICAgICAgIC8vICAgICBjb25zb2xlLmxvZygiPT09PT09PT09PT09PT09PT09IikKICAgICAgICAvLyAgICAgY29uc29sZS5sb2codGhpcy50aW1lKQogICAgICAgIC8vICAgICBjb25zb2xlLmxvZyh0aGlzLmZyb21fbmFtZSkKICAgICAgICAvLyAgICAgY29uc29sZS5sb2codGhpcy5tZXNzYWdlKQogICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTsKCiAgICAgICAgaWYgKGRhdGEudXNlck5hbWUpIHsKICAgICAgICAgICR0aGlzLm1lc3NhZ2VMaXN0LnB1c2goZGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMub25saW5lID0gZGF0YTsKICAgICAgICAgIGNvbnNvbGUubG9nKCJ4eHh4eHh4eHh4eHh4eHh4eHh6enp6enp6IiArIGRhdGEpOwoKICAgICAgICAgICR0aGlzLl9ub3RpZnkoJ+aPkOmGkicsICflvZPliY3lnKjnur/kurrmlbA6JyArIGRhdGEsICdpbmZvJyk7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy5zY3JvbGwoKTsKICAgICAgfTsgLy/pk77mjqXlhbPpl63ml7bosIPnlKgKCgogICAgICB0aGlzLndlYnNvY2tldC5vbmNsb3NlID0gZnVuY3Rpb24gKCkgewogICAgICAgICR0aGlzLl9ub3RpZnkoJ+aPkOmGkicsICdXZWJTb2NrZXTpk77mjqXlhbPpl60nLCAnaW5mbycpOwogICAgICB9OwogICAgfSwKICAgIC8v5o6o6YCB5raI5oGvCiAgICBzZW5kOiBmdW5jdGlvbiBzZW5kKCkgewogICAgICBpZiAodGhpcy5mb3JtLm1lc3NhZ2UgPT0gbnVsbCB8fCB0aGlzLmZvcm0ubWVzc2FnZS50cmltKCkgPT0gJycpIHsKICAgICAgICB0aGlzLl9tZXNzYWdlKCfor7fovpPlhaXmtojmga/lhoXlrrknLCAnd2FybmluZycpOwoKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIG15RGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgdGhpcy5tZXNzYWdlRm9ybWF0LnVzZXJJZCA9IG15RGF0ZS50b0xvY2FsZVN0cmluZygpOwogICAgICAgIHRoaXMubWVzc2FnZUZvcm1hdC51c2VyTmFtZSA9IHRoaXMubmFtZTsKICAgICAgICB0aGlzLm1lc3NhZ2VGb3JtYXQubXNnID0gdGhpcy5mb3JtLm1lc3NhZ2U7CiAgICAgICAgdmFyIHNlbmRNZXNzYWdlID0gSlNPTi5zdHJpbmdpZnkodGhpcy5tZXNzYWdlRm9ybWF0KTsKICAgICAgICB0aGlzLndlYnNvY2tldC5zZW5kKHNlbmRNZXNzYWdlKTsKICAgICAgfQoKICAgICAgdGhpcy5mb3JtLm1lc3NhZ2UgPSAnJzsKICAgICAgdGhpcy5zY3JvbGwoKTsKICAgIH0sCiAgICAvL+a4heepuua2iOaBrwogICAgY2xlYW46IGZ1bmN0aW9uIGNsZWFuKCkgewogICAgICB0aGlzLmZvcm0ubWVzc2FnZSA9ICcnOwogICAgfSwKICAgIC8v5YiH5o2i6YCJ5oup56qX5Y+jCiAgICBzZWxlY3RXaW5kb3c6IGZ1bmN0aW9uIHNlbGVjdFdpbmRvdyhpZCkgewogICAgICB0aGlzLmN1cnJlbnRfd2luZG93X2lkID0gaWQ7CgogICAgICBpZiAoIXRoaXMuY3VycmVudF93aW5kb3dfaWQpIHsKICAgICAgICB0aGlzLmluaXRDb21tb25NZXNzYWdlKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pbml0U2VsZk1lc3NhZ2UoKTsKICAgICAgfQogICAgfSwKICAgIC8v56qX5Y+j5rua5YqoCiAgICBzY3JvbGw6IGZ1bmN0aW9uIHNjcm9sbCgpIHsKICAgICAgdmFyIGJveCA9IHRoaXMuJHJlZnMuYm94OyAvLyBib3guc2Nyb2xsVG9wID0gMTAwMDAwMDAKICAgIH0sCiAgICBjbG9zZVdlYnNvY2tldDogZnVuY3Rpb24gY2xvc2VXZWJzb2NrZXQoKSB7CiAgICAgIGlmICh0aGlzLndzKSB7CiAgICAgICAgdGhpcy53cy5jbG9zZSgpOwoKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICB0aGlzLndzLm9uY2xvc2UgPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAkdGhpcy5fbm90aWZ5KCfmj5DphpInLCAnV2ViU29ja2V05YWz6ZetJywgJ2luZm8nKTsKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgfSwKICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiBiZWZvcmVEZXN0cm95KCkgewogICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiBfdGhpczQuY2xvc2VXZWJzb2NrZXQoZSk7CiAgICB9KTsKICB9Cn07"},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA;AAEA;AACAA,cADA;AAEAC,MAFA,kBAEA;AACA;AACAC,eADA;AAEAC,0BAFA;AAGAH,cAHA;AAIAI,qBAJA;AAKAC;AAAAC;AAAA,OALA;AAOAC;AACAC,+BADA;AAEAC,oBAFA;AAGAC;AAHA,OAPA;AAcAC,qBAdA;AAeAC;AAfA;AAkBA,GArBA;AAsBAC,SAtBA,qBAsBA;AACA;AACA,GAxBA;AAyBAC,SAzBA,qBAyBA;AAEA;AACA,GA5BA;AA6BAC,SA7BA,qBA6BA;AAAA;;AACA;AACAC;AAAA;AAAA;AACA,GAhCA;AAiCAC;AACAC,YADA,oBACAZ,OADA,EACAa,IADA,EACA;AACA;AACAb,wBADA;AAEAa;AAFA;AAIA,KANA;AAOAC,WAPA,mBAOAC,KAPA,EAOAf,OAPA,EAOAa,IAPA,EAOA;AACA;AACAE,oBADA;AAEAf,wBAFA;AAGAa;AAHA;AAKA,KAbA;AAgBAG,QAhBA,kBAgBA;AAGA;AAGA;AACA,KAvBA;AAyBAC,YAzBA,sBAyBA;AAAA;;AAEAC,iCACA;AACA;AACA,OAHA;AAMA,KAjCA;AAmCAC,iBAnCA,2BAmCA;AACA,uBADA,CAEA;;AACA,sEAHA,CAKA;;AACA;AACAC;AACA,OAFA,CANA,CASA;;;AACA;AACAA;AACA,OAFA,CAVA,CAcA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACAA;AACA,SAFA,MAGA;AACA;AACAC;;AACAD;AACA;;AACAA;AACA,OArBA,CAfA,CAqCA;;;AACA;AAEAA;AACA,OAHA;AAKA,KA9EA;AAgFA;AACAE,QAjFA,kBAiFA;AACA;AACA;;AACA;AACA,OAHA,MAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AACA;AACA;AACA,KAjGA;AAmGA;AACAC,SApGA,mBAoGA;AACA;AACA,KAtGA;AAuGA;AACAC,gBAxGA,wBAwGAC,EAxGA,EAwGA;AACA;;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA,KA/GA;AAiHA;AACAC,UAlHA,oBAkHA;AACA,+BADA,CAEA;AACA,KArHA;AAuHAC,kBAvHA,4BAuHA;AACA;AACA;;AACA;;AACA;AACAP;AACA,SAFA;AAGA;AACA;AA/HA,GAjCA;AAkKAQ,eAlKA,2BAkKA;AAAA;;AACAlB;AAAA;AAAA;AACA;AApKA","names":["name","data","online","websocket","showMessage","form","message","messageFormat","userId","userName","msg","messageList","ws","updated","mounted","created","window","methods","_message","type","_notify","title","init","initUser","exam","initWebSocket","$this","console","send","clean","selectWindow","id","scroll","closeWebsocket","beforeDestroy"],"sourceRoot":"src/components/user","sources":["Chat.vue"],"sourcesContent":["<template>\n  <div id=\"app\">\n    <div class=\"page-loader\" ref=\"loader\">\n      <div class=\"page-loader__spinner\">\n        <svg viewBox=\"25 25 50 50\">\n          <circle cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-width=\"2\" stroke-miterlimit=\"10\"/>\n        </svg>\n      </div>\n    </div>\n    <div class=\"sidebar\">\n      <div class=\"card\">\n        <header>\n          <p class=\"name\">{{name}}</p>\n        </header>\n      </div>\n      <div class=\"list\">\n        <ul>\n          <li>\n            <img class=\"avatar\" width=\"30\" height=\"30\" src=\"../../assets/imgs/group.png\">\n            <p class=\"name\">系统群聊</p>\n          </li>\n        </ul>\n      </div>\n    </div>\n    <div class=\"main\">\n      <div class=\"message\" ref=\"box\">\n        <ul>\n          <li v-for=\"(item,key) in messageList\" :id=\"key == (messageList.length - 1) ? 'end' : ''\">\n            <p class=\"time\">\n              <span>{{item.userId}}</span>\n            </p>\n             <div >\n              <span class=\"main-name\">来自:{{item.userName}}</span>\n              <div class=\"text\">{{item.msg}}</div>\n            </div>\n          </li>\n        </ul>\n      </div>\n      <div class=\"text\">\n        <el-input\n          v-model=\"form.message\" @keyup.native.enter=\"send\"\n          type=\"textarea\" :rows=\"5\" placeholder=\"请输入内容，按 Enter 键发送\">\n        </el-input>\n        <div class=\"btn\">\n          <el-button @click=\"clean\" size=\"mini\" type=\"danger\">清空</el-button>\n          <el-button @click=\"send\" size=\"mini\" icon=\"el-icon-position\" type=\"success\">发送</el-button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n  import exam from \"../../api/exam\";\n\n    export default {\n        name: \"Chat\",\n        data() {\n            return {\n                online: 0,\n                websocket: undefined,\n                    name: '',\n                showMessage:'',\n                form: {message: ''},\n\n                messageFormat:{\n                    userId:'1629903139122',\n                    userName:'',\n                    msg:''\n                },\n\n\n               messageList:[],\n                ws:\"\",\n\n            }\n        },\n        updated() {\n            this.scroll()\n        },\n        mounted() {\n\n            this.$refs.loader.style.display = 'none';\n        },\n        created() {\n            this.init();\n            window.addEventListener('beforeunload', e => this.closeWebsocket(e))\n        },\n        methods: {\n            _message(message, type) {\n                this.$message({\n                    message: message,\n                    type: type\n                })\n            },\n            _notify(title, message, type) {\n                this.$notify({\n                    title: title,\n                    message: message,\n                    type: type\n                });\n            },\n\n\n            init() {\n\n\n                this.initUser();\n\n\n                this.initWebSocket();\n            },\n\n            initUser() {\n\n                exam.getUserAccount().then(\n                    response=>{\n                        this.name=response.data.obj\n                    }\n                )\n\n            },\n\n            initWebSocket() {\n                let $this = this;\n                // this.websocket = new WebSocket(api.websocket(this.form.id))\n                this.websocket = new WebSocket(\"ws://localhost:8889/websocket\");\n\n                //链接发送错误时调用\n                this.websocket.onerror = function () {\n                    $this._notify('提醒', 'WebSocket链接错误', 'error')\n                }\n                //链接成功时调用\n                this.websocket.onopen = function (event) {\n                    $this._notify('提醒', 'WebSocket链接成功', 'success')\n                }\n\n                //接收到消息时回调\n                 this.websocket.onmessage = function (event) {\n                //     let entity = JSON.parse(event.data);\n                //     var myDate = new Date();\n                //     console.log(\"xxxxxxxxxxx\"+myDate.toLocaleString())\n                //     this.time=myDate.toLocaleString()\n                //     this.from_name=entity.userName\n                //     this.message=entity.msg\n                //     console.log(\"==================\")\n                //     console.log(this.time)\n                //     console.log(this.from_name)\n                //     console.log(this.message)\n                  let data = JSON.parse(event.data)\n                     if(data.userName){\n                           $this.messageList.push(data)\n                     }\n                     else {\n                         this.online=data\n                         console.log(\"xxxxxxxxxxxxxxxxxxzzzzzzz\"+data)\n                         $this._notify('提醒', '当前在线人数:'+data,'info' )\n                     }\n                     $this.scroll()\n                }\n                //链接关闭时调用\n                this.websocket.onclose = function () {\n\n                    $this._notify('提醒', 'WebSocket链接关闭', 'info')\n                }\n\n            },\n\n            //推送消息\n            send() {\n                if (this.form.message == null || this.form.message.trim() == '') {\n                    this._message('请输入消息内容', 'warning')\n                    return;\n                      }\n                else {\n                    var myDate = new Date();\n                    this.messageFormat.userId=myDate.toLocaleString()\n                    this.messageFormat.userName=this.name\n                    this.messageFormat.msg=this.form.message\n\n                   let sendMessage= JSON.stringify(this.messageFormat)\n                    this.websocket.send(sendMessage)\n                }\n                this.form.message=''\n                this.scroll()\n            },\n\n            //清空消息\n            clean() {\n                this.form.message = ''\n            },\n            //切换选择窗口\n            selectWindow(id) {\n                this.current_window_id = id;\n                if (!this.current_window_id) {\n                    this.initCommonMessage();\n                } else {\n                    this.initSelfMessage();\n                }\n            },\n\n            //窗口滚动\n            scroll() {\n                let box = this.$refs.box\n                // box.scrollTop = 10000000\n            },\n\n            closeWebsocket(){\n                if(this.ws){\n                    this.ws.close();\n                    let _this=this\n                    this.ws.onclose = function(evt) {\n                        $this._notify('提醒', 'WebSocket关闭', 'info')\n                    };\n                }\n            }\n        },\n        beforeDestroy() {\n            window.addEventListener('beforeunload', e => this.closeWebsocket(e))\n        }\n\n    }\n</script>\n\n<style scoped lang=\"css\">\n  @import \"../../assets/css/chat/main.css\";\n</style>\n"]}]}
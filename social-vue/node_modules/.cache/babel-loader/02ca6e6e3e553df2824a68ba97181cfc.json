{"remainingRequest":"/home/ckg/A毕设/exam-vue/node_modules/babel-loader/lib/index.js!/home/ckg/A毕设/exam-vue/node_modules/cache-loader/dist/cjs.js??ref--1-0!/home/ckg/A毕设/exam-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ckg/A毕设/exam-vue/src/components/user/Chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/ckg/A毕设/exam-vue/src/components/user/Chat.vue","mtime":1649580872948},{"path":"/home/ckg/A毕设/exam-vue/babel.config.js","mtime":1648737495000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ckg/A毕设/exam-vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuanNvbi5zdHJpbmdpZnkuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vIGltcG9ydCB7bGlzdE1zZyxzZW5kTXNnIH0gZnJvbSAiQC9hcGkvaW5kZXgiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIk1lc0JvYXJkIiwKICBwcm9wczogewogICAgdmFsdWU6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0KICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjaGF0VmlzaWJsZTogdGhpcy52YWx1ZSwKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIGRlZnVhbHRBdmF0YXI6IHJlcXVpcmUoJy4uLy4uL2Fzc2V0cy9sb2dvLnBuZycpLAogICAgICAvLyDlkI7nq6/msqHmnInov5Tlm57lpLTlg4/pu5jorqTlpLTlg4/vvIzms6jmhI/vvJrpnIDopoHnlKhyZXF1aXJl6K+35rGC5pa55byP5omN6IO95Yqo5oCB6K6/6Zeu5pys5Zyw5paH5Lu2CiAgICAgIGRhdGE6IFtdLAogICAgICBkaXN0aW5jRGF0YTogW10sCiAgICAgIC8vIOa2iOaBr+WOu+mHjeaVsOe7hAogICAgICBvZmZzZXRNYXg6IDAsCiAgICAgIC8vIOacgOWkp+WBj+enu+S9je+8jOiusOW9leW9k+WJjeiOt+WPlueahOacgOWkp2lk77yM5b6A5ZCO55qE5a6a5pe26L2u6K+i5pWw5o2u5pe25q+P5qyh5Y+q6I635Y+W5q+U6L+Z5LiqaWTlpKfnmoTmlbDmja4KICAgICAgb2Zmc2V0TWluOiAwLAogICAgICAvLyDmnIDlsI/lgY/np7vkvY3vvIzorrDlvZXlvZPliY3ojrflj5bnmoTmnIDlsI9pZO+8jOW+gOS4iua7keWKqOaXtuavj+asoeWPquiOt+WPluavlOi/meWwj2lk5aSn55qE5pWw5o2uCiAgICAgIHNlYXJjaEZvcm06IHsKICAgICAgICAvLyDmr4/mrKHlrprml7bojrflj5bmlbDmja7miJbpppbmrKHliqDovb3mlbDmja7mj5DkuqTnmoRmb3Jt6KGo5Y2V5pWw5o2uCiAgICAgICAgcGFnZU51bWJlcjogMSwKICAgICAgICBwYWdlU2l6ZTogMjAKICAgICAgfSwKICAgICAgZm9ybTogewogICAgICAgIC8vIOWPkemAgeaVsOaNruaPkOS6pOaVsOaNruihqOWNlQogICAgICAgIGNvbnRlbnQ6ICIiLAogICAgICAgIG1zZzogIiIKICAgICAgfSwKICAgICAgdGltZXJTd2l0Y2g6IDAgLy8g5a6a5pe25Zmo5byA5YWz77yM6buY6K6k5YWz6ZetCgogICAgfTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7fSwKICAgIGxvYWRNc2c6IGZ1bmN0aW9uIGxvYWRNc2coKSB7CiAgICAgIC8vIOeql+S9k+aJk+W8gOm7mOiupOWKoOi9veS4gOmhteaVsOaNru+8jOeql+S9k+S7gOS5iOWRqOacn+S4reWAvOi/kOihjOS4gOasoQogICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgIHRoaXMuc2VhcmNoRm9ybS5vZmZzZXRNYXggPSB0aGlzLm9mZnNldE1heDsgLy8gbGlzdE1zZyh0aGlzLnNlYXJjaEZvcm0pLnRoZW4ocmVzPT57CiAgICAgIC8vICAgICBpZiAocmVzLmNvZGUgPT0gMjAwKSB7CiAgICAgIC8vICAgICAgICAgcmVzLmRhdGEuZm9yRWFjaChlID0+IHsKICAgICAgLy8gICAgICAgICAgICAgLy8g5qCH6K6w5pyA5aSn5YGP56e75L2NCiAgICAgIC8vICAgICAgICAgICAgIGlmKHRoYXQub2Zmc2V0TWF4IDwgZS5tc2dJZCl7CiAgICAgIC8vICAgICAgICAgICAgICAgICB0aGF0Lm9mZnNldE1heCA9IGUubXNnSWQ7CiAgICAgIC8vICAgICAgICAgICAgIH0KICAgICAgLy8gICAgICAgICAgICAgZS5jb250ZW50ID0gSlNPTi5wYXJzZShlLmNvbnRlbnQpOwogICAgICAvLyAgICAgICAgICAgICB0aGF0LmRhdGEudW5zaGlmdChlKQogICAgICAvLyAgICAgICAgICAgICB0aGF0LmRpc3RpbmNEYXRhLnB1c2goZS5tc2dJZCk7CiAgICAgIC8vICAgICAgICAgICAgIC8vIOagh+iusOacgOWkp+WBj+enu+S9je+8jOWQjuerr+i/lOWbnuaVsOaNruaYr+mAhuW6j++8jOaJgOS7peacgOWQjuS4gOadoWlk5pyA5pawCiAgICAgIC8vICAgICAgICAgICAgIHRoYXQub2Zmc2V0TWluID0gZS5tc2dJZDsKICAgICAgLy8gICAgICAgICB9KTsKICAgICAgLy8gICAgICAgICAvLyDmlbDmja7liqDovb3lrozmiJDvvIzmu5rliqjmnaHmu5rliqjliLDnqpfkvZPlupXpg6gKICAgICAgLy8gICAgICAgICB0aGlzLnNjcm9sbFRvQm90dG9tKCk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vIH0pOwogICAgfSwKICAgIHNob3c6IGZ1bmN0aW9uIHNob3coKSB7CiAgICAgIC8vIOaJk+W8gOeql+S9k+WIneWni+WMluaVsOaNrgogICAgICAvLyDliJ3lp4vljJbmlbDmja4KICAgICAgdGhpcy5kYXRhID0gW107CiAgICAgIHRoaXMuZGlzdGluY0RhdGEgPSBbXTsKICAgICAgdGhpcy5vZmZzZXRNYXggPSAwOwogICAgICB0aGlzLm9mZnNldE1pbiA9IDA7CiAgICAgIHRoaXMuc2VhcmNoRm9ybS5wYWdlTnVtYmVyID0gMTsKICAgICAgdGhpcy5zZWFyY2hGb3JtLnBhZ2VTaXplID0gMjA7CiAgICAgIHRoaXMuZm9ybSA9IHsKICAgICAgICBjb250ZW50OiAiIiwKICAgICAgICBtc2c6ICIiCiAgICAgIH07CiAgICAgIHRoaXMubG9hZE1zZygpOwogICAgICB0aGlzLmNoYXRWaXNpYmxlID0gdHJ1ZTsgLy8g5byA5ZCv5a6a5pe25ZmoCgogICAgICB0aGlzLnRpbWVyU3dpdGNoID0gMTsKICAgICAgdGhpcy5yZWxvYWREYXRhKCk7CiAgICB9LAogICAgc2VuZE1zZzogZnVuY3Rpb24gc2VuZE1zZygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIC8vIOWPkemAgea2iOaBrwogICAgICBpZiAoIXRoaXMuZm9ybS5tc2cpIHsKICAgICAgICB0aGlzLiRNZXNzYWdlLndhcm5pbmcoIuS4jeiDveWPkemAgeepuueZveS/oeaBryIpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGNvbnRlbnQgPSB7CiAgICAgICAgLy8g5bCB6KOF5raI5oGv5L2TCiAgICAgICAgdHlwZTogInR4dCIsCiAgICAgICAgbXNnOiB0aGlzLmZvcm0ubXNnCiAgICAgIH07CiAgICAgIHRoaXMuZm9ybS5jb250ZW50ID0gSlNPTi5zdHJpbmdpZnkoY29udGVudCk7CiAgICAgIHNlbmRPcmRlck1zZyh0aGlzLmZvcm0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIGlmIChyZXMuY29kZSA9PSAyMDApIHsKICAgICAgICAgIHJlcy5kYXRhLmNvbnRlbnQgPSBKU09OLnBhcnNlKHJlcy5kYXRhLmNvbnRlbnQpOwoKICAgICAgICAgIF90aGlzLmRhdGEucHVzaChyZXMuZGF0YSk7CgogICAgICAgICAgX3RoaXMuZm9ybS5tc2cgPSAiIjsKCiAgICAgICAgICBfdGhpcy5kaXN0aW5jRGF0YS5wdXNoKHJlcy5kYXRhLm1zZ0lkKTsKCiAgICAgICAgICBfdGhpcy5zY3JvbGxUb0JvdHRvbSgpOyAvLyDlj5HpgIHkv6Hmga/lj6rov5Tlm57lvZPliY3kuIDmnaHvvIzmraTml7blj6/og73lr7nmlrnlt7Lnu4/lj5HpgIHkv6Hmga/vvIzmiYDku6XkuI3kv67mlLnlgY/np7vph48KCiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzY3JvbGxUb0JvdHRvbTogZnVuY3Rpb24gc2Nyb2xsVG9Cb3R0b20oKSB7CiAgICAgIC8vIOa7muWKqOWIsOeql+S9k+W6lemDqAogICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGNoYXRmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXRmb3JtIik7CiAgICAgICAgY2hhdGZvcm0uc2Nyb2xsVG9wID0gY2hhdGZvcm0uc2Nyb2xsSGVpZ2h0OwogICAgICB9KTsKICAgIH0sCiAgICAvLyDmu5rliqjliLDmnIDkuIrmlrnvvIzlj5bljoblj7LmlbDmja7vvIzmoLnmja7liIbpobXlj4LmlbDlj5bjgILkuI3nlKjkv67mlLnlgY/np7vmoIforrDkvY3vvIzkvYbmmK/pnIDopoHliKTph40KICAgIHNjcm9sbDogZnVuY3Rpb24gc2Nyb2xsKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBjaGF0Zm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0Zm9ybSIpOwogICAgICB2YXIgc2Nyb2xsVG9wID0gY2hhdGZvcm0uc2Nyb2xsVG9wOwoKICAgICAgaWYgKHNjcm9sbFRvcCA9PSAwKSB7CiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgICAgdGhpcy5zZWFyY2hGb3JtLm9mZnNldE1pbiA9IHRoaXMub2Zmc2V0TWluOwogICAgICAgIHRoaXMuc2VhcmNoRm9ybS5vZmZzZXRNYXggPSAiIjsKICAgICAgICBsaXN0TXNnQnlPcmRlcih0aGlzLnNlYXJjaEZvcm0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgX3RoaXMyLmxvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzLmNvZGUgPT0gMjAwKSB7CiAgICAgICAgICAgIHJlcy5kYXRhLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBpZiAodGhhdC5kaXN0aW5jRGF0YS5pbmRleE9mKGUubXNnSWQpIDwgMCkgewogICAgICAgICAgICAgICAgZS5jb250ZW50ID0gSlNPTi5wYXJzZShlLmNvbnRlbnQpOwogICAgICAgICAgICAgICAgdGhhdC5kYXRhLnVuc2hpZnQoZSk7CiAgICAgICAgICAgICAgICB0aGF0LmRpc3RpbmNEYXRhLnB1c2goZS5tc2dJZCk7IC8vIOS/ruaUueacgOWwj+WBj+enu+S9jQoKICAgICAgICAgICAgICAgIGlmICh0aGF0Lm9mZnNldE1pbiA+IGUubXNnSWQpIHsKICAgICAgICAgICAgICAgICAgdGhhdC5vZmZzZXRNaW4gPSBlLm1zZ0lkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICByZWxvYWREYXRhOiBmdW5jdGlvbiByZWxvYWREYXRhKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIC8vIOWIpOaWreWumuaXtuWZqOW8gOWFs+aYr+WQpuW8gOWQr++8jOWmguaenOW8gOWQr++8jOWImeaJp+ihjOWumuaXtuWZqAogICAgICBpZiAodGhpcy50aW1lclN3aXRjaCkgewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHBhcmFtcyA9IHt9OwogICAgICAgICAgcGFyYW1zLnBhZ2VOdW1iZXIgPSAxOwogICAgICAgICAgcGFyYW1zLnBhZ2VTaXplID0gMjA7CiAgICAgICAgICBwYXJhbXMub2Zmc2V0TWF4ID0gX3RoaXMzLm9mZnNldE1heDsKICAgICAgICAgIHZhciB0aGF0ID0gX3RoaXMzOwogICAgICAgICAgbGlzdE1zZ0J5T3JkZXIocGFyYW1zKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgaWYgKHJlcy5jb2RlID09IDIwMCkgewogICAgICAgICAgICAgIHJlcy5kYXRhLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIC8vIOS/ruaUueacgOWkp+WBj+enu+S9je+8jOaUvuWIsOagoemqjOmHjeWkjeS5i+WJje+8jOmYsuatouW9k+WJjeWPkemAgeS/oeaBr+W3sue7j+aUvuWFpea2iOaBr+WIl+ihqO+8jOS9huaYr+WBj+enu+WAvOayoeivpeeahOaDheWGtQogICAgICAgICAgICAgICAgaWYgKHRoYXQub2Zmc2V0TWF4IDwgZS5tc2dJZCkgewogICAgICAgICAgICAgICAgICB0aGF0Lm9mZnNldE1heCA9IGUubXNnSWQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoYXQuZGlzdGluY0RhdGEuaW5kZXhPZihlLm1zZ0lkKSA8IDApIHsKICAgICAgICAgICAgICAgICAgZS5jb250ZW50ID0gSlNPTi5wYXJzZShlLmNvbnRlbnQpOwogICAgICAgICAgICAgICAgICB0aGF0LmRhdGEucHVzaChlKTsKICAgICAgICAgICAgICAgICAgdGhhdC5kaXN0aW5jRGF0YS5wdXNoKGUubXNnSWQpOyAvLyDmlLbliLDmlrDmtojmga/vvIzliKTmlq3pq5jluqbvvIzlpoLmnpzlvZPliY3mu5rliqjmnaHpq5jluqbot53lupXpg6jlsI/kuo4xMDDvvIzliJnliqjmu5HliLDlupXpg6gKCiAgICAgICAgICAgICAgICAgIHZhciBjaGF0Zm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0Zm9ybSIpOwogICAgICAgICAgICAgICAgICB2YXIgZ2FwID0gY2hhdGZvcm0uc2Nyb2xsSGVpZ2h0IC0gY2hhdGZvcm0uc2Nyb2xsVG9wOwoKICAgICAgICAgICAgICAgICAgaWYgKGdhcCA+IDAgJiYgZ2FwIDwgNDAwKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMzLnNjcm9sbFRvQm90dG9tKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGF0LnJlbG9hZERhdGEoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwgMTAwMCAqIDIpOwogICAgICB9CiAgICB9LAogICAgY2FuY2VsOiBmdW5jdGlvbiBjYW5jZWwoKSB7CiAgICAgIC8vIOWFs+mXreeql+S9k+mcgOimgeaKiuaPkOekuuS7u+WKoeW8gOWFs+S4gOi1t+WFs+mXreiwgwogICAgICB0aGlzLmNoYXRWaXNpYmxlID0gZmFsc2U7CiAgICAgIHRoaXMudGltZXJTd2l0Y2ggPSAwOwogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHt9Cn07"},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDA;AACA;AACAA,kBADA;AAEAC;AACAC;AACAC,mBADA;AAEAC;AAFA;AADA,GAFA;AAQAC,MARA,kBAQA;AACA;AACAC,6BADA;AAEAC,oBAFA;AAGAC,qDAHA;AAGA;AACAH,cAJA;AAKAI,qBALA;AAKA;AACAC,kBANA;AAMA;AACAC,kBAPA;AAOA;AACAC;AAAA;AACAC,qBADA;AAEAC;AAFA,OARA;AAYAC;AAAA;AACAC,mBADA;AAEAC;AAFA,OAZA;AAgBAC,oBAhBA,CAgBA;;AAhBA;AAkBA,GA3BA;AA4BAC;AACAC,QADA,kBACA,CAEA,CAHA;AAIAC,WAJA,qBAIA;AAAA;AACA;AACA,iDAFA,CAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA,KA1BA;AA2BAC,QA3BA,kBA2BA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAN,mBADA;AAEAC;AAFA;AAIA;AACA,8BAbA,CAcA;;AACA;AACA;AACA,KA5CA;AA6CAM,WA7CA,qBA6CA;AAAA;;AAAA;AACA;AACA;AACA;AACA;;AACA;AAAA;AACApB,mBADA;AAEAc;AAFA;AAIA;AACAO;AACA;AACAC;;AACA;;AACA;;AACA;;AACA,iCALA,CAMA;;AACA;AACA,OATA;AAUA,KAjEA;AAkEAC,kBAlEA,4BAkEA;AAAA;AACA;AACA;AACAC;AACA,OAHA;AAIA,KAvEA;AAwEA;AACAC,UAzEA,oBAyEA;AAAA;;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACAC;AACA;;AACA;AACAJ;AACA;AACAK;AACAC;AACAA,+CAHA,CAIA;;AACA;AACAA;AACA;AACA;AACA,aAVA;AAWA;AACA,SAfA;AAgBA;AACA,KAlGA;AAmGAC,cAnGA,wBAmGA;AAAA;;AACA;AACA;AACAC;AACA;AACAC;AACAA;AACAA;AACA;AACAL;AACA;AACAJ;AACA;AACA;AACAM;AACA;;AACA;AACAD;AACAC;AACAA,iDAHA,CAIA;;AACA;AACA;;AACA;AACA;AACA;AACA;AACA,eAhBA;AAiBAA;AACA;AACA,WArBA;AAsBA,SA5BA,EA4BA,QA5BA;AA6BA;AAEA,KArIA;AAsIAI,UAtIA,oBAsIA;AAAA;AACA;AACA;AACA;AAzIA,GA5BA;AAuKAC,SAvKA,qBAuKA,CACA;AAxKA","names":["name","props","value","type","default","data","chatVisible","loading","defualtAvatar","distincData","offsetMax","offsetMin","searchForm","pageNumber","pageSize","form","content","msg","timerSwitch","methods","init","loadMsg","show","sendMsg","sendOrderMsg","res","scrollToBottom","chatform","scroll","listMsgByOrder","e","that","reloadData","setTimeout","params","cancel","mounted"],"sourceRoot":"src/components/user","sources":["Chat.vue"],"sourcesContent":["<template>\n    <div>\n        聊天室\n    </div>\n\n    <Modal title=\"在线沟通\" v-model=\"chatVisible\"\n           draggable\n           footer-hide\n           :width=\"580\" @on-cancel=\"cancel\">\n      <div class=\"chat\">\n        <div  class=\"chat-message-body\" id =\"chatform\" @scroll=\"scroll\"\n        >\n          <Spin v-if=\"loading\">\n            <Icon type=\"ios-loading\" size=18 class=\"spin-icon-load\"></Icon>\n          </Spin>\n          <div  dis-hover v-for=\"(item,index) in data\"\n                :key=\"index\" class=\"message-card\">\n            <div :class=\"item.isOneself == 1?'message-row-right': 'message-row-left'\">\n              <img :src=\"item.avatar?item.avatar:defualtAvatar\"\n                   height=\"35\" width=\"35\" >\n              <div class=\"message-content\">\n                <div :style=\"item.isOneself == 1?'text-align:right;display: flex;flex-direction:row-reverse':''\">\n                  {{item.nickName}}\n                  <span class=\"message-time\">\n                   {{item.createTime}}</span>\n                </div>\n                <div class=\"message-body\">\n                  {{item.content.msg}}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <Input\n          v-model=\"form.msg\"\n          type=\"textarea\"\n          style=\"margin:10px 0;\"\n          placeholder=\"主动一点，世界会更大！\"\n          :rows=\"4\"\n        />\n      </div>\n      <div class=\"footer-btn\">\n        <Button @click=\"cancel\" type=\"text\">取消</Button>\n        <Button type=\"primary\" @click=\"sendMsg\">发送</Button>\n      </div>\n    </Modal>\n\n</template>\n<script>\n    // import {listMsg,sendMsg } from \"@/api/index\";\n    export default {\n        name: \"MesBoard\",\n        props: {\n            value: {\n                type: Boolean,\n                default: false\n            }\n        },\n        data() {\n            return {\n                chatVisible:this.value,\n                loading:false,\n                defualtAvatar:require('../../assets/logo.png'), // 后端没有返回头像默认头像，注意：需要用require请求方式才能动态访问本地文件\n                data:[],\n                distincData:[], // 消息去重数组\n                offsetMax:0, // 最大偏移位，记录当前获取的最大id，往后的定时轮询数据时每次只获取比这个id大的数据\n                offsetMin:0,  // 最小偏移位，记录当前获取的最小id，往上滑动时每次只获取比这小id大的数据\n                searchForm:{ // 每次定时获取数据或首次加载数据提交的form表单数据\n                    pageNumber: 1,\n                    pageSize: 20\n                },\n                form:{ // 发送数据提交数据表单\n                    content:\"\",\n                    msg:\"\"\n                },\n                timerSwitch:0 // 定时器开关，默认关闭\n            };\n        },\n        methods: {\n            init(){\n\n            },\n            loadMsg(){ // 窗体打开默认加载一页数据，窗体什么周期中值运行一次\n                let that = this;\n                this.searchForm.offsetMax = this.offsetMax;\n                // listMsg(this.searchForm).then(res=>{\n                //     if (res.code == 200) {\n                //         res.data.forEach(e => {\n                //             // 标记最大偏移位\n                //             if(that.offsetMax < e.msgId){\n                //                 that.offsetMax = e.msgId;\n                //             }\n                //             e.content = JSON.parse(e.content);\n                //             that.data.unshift(e)\n                //             that.distincData.push(e.msgId);\n                //             // 标记最大偏移位，后端返回数据是逆序，所以最后一条id最新\n                //             that.offsetMin = e.msgId;\n                //         });\n                //         // 数据加载完成，滚动条滚动到窗体底部\n                //         this.scrollToBottom();\n                //     }\n                // });\n\n\n            },\n            show(){ // 打开窗体初始化数据\n                // 初始化数据\n                this.data =[];\n                this.distincData =[];\n                this.offsetMax = 0;\n                this.offsetMin = 0;\n                this.searchForm.pageNumber = 1;\n                this.searchForm.pageSize = 20;\n                this.form ={\n                    content:\"\",\n                    msg:\"\"\n                };\n                this.loadMsg();\n                this.chatVisible = true;\n                // 开启定时器\n                this.timerSwitch = 1;\n                this.reloadData();\n            },\n            sendMsg(){ // 发送消息\n                if(!this.form.msg){\n                    this.$Message.warning(\"不能发送空白信息\");\n                    return;\n                }\n                let content = { // 封装消息体\n                    type:\"txt\",\n                    msg:this.form.msg\n                };\n                this.form.content = JSON.stringify(content);\n                sendOrderMsg(this.form).then(res=>{\n                    if (res.code == 200) {\n                        res.data.content = JSON.parse(res.data.content);\n                        this.data.push(res.data)\n                        this.form.msg=\"\";\n                        this.distincData.push(res.data.msgId);\n                        this.scrollToBottom();\n                        // 发送信息只返回当前一条，此时可能对方已经发送信息，所以不修改偏移量\n                    }\n                });\n            },\n            scrollToBottom(){ // 滚动到窗体底部\n                this.$nextTick(()=>{\n                    let chatform = document.getElementById(\"chatform\");\n                    chatform.scrollTop = chatform.scrollHeight;\n                });\n            },\n            // 滚动到最上方，取历史数据，根据分页参数取。不用修改偏移标记位，但是需要判重\n            scroll(){\n                let chatform = document.getElementById(\"chatform\");\n                let scrollTop = chatform.scrollTop;\n                if(scrollTop == 0){\n                    this.loading =true;\n                    let that = this;\n                    this.searchForm.offsetMin = this.offsetMin;\n                    this.searchForm.offsetMax = \"\";\n                    listMsgByOrder(this.searchForm).then(res=>{\n                        this.loading =false;\n                        if (res.code == 200) {\n                            res.data.forEach(e => {\n                                if(that.distincData.indexOf(e.msgId) <0){\n                                    e.content = JSON.parse(e.content);\n                                    that.data.unshift(e);\n                                    that.distincData.push(e.msgId);\n                                    // 修改最小偏移位\n                                    if(that.offsetMin > e.msgId){\n                                        that.offsetMin = e.msgId;\n                                    }\n                                }\n                            });\n                        }\n                    });\n                }\n            },\n            reloadData(){\n                // 判断定时器开关是否开启，如果开启，则执行定时器\n                if(this.timerSwitch){\n                    setTimeout(() => {\n                        let params = {};\n                        params.pageNumber = 1;\n                        params.pageSize = 20;\n                        params.offsetMax = this.offsetMax;\n                        let that = this;\n                        listMsgByOrder(params).then(res=>{\n                            if (res.code == 200) {\n                                res.data.forEach(e => {\n                                    // 修改最大偏移位，放到校验重复之前，防止当前发送信息已经放入消息列表，但是偏移值没该的情况\n                                    if(that.offsetMax < e.msgId){\n                                        that.offsetMax = e.msgId;\n                                    }\n                                    if(that.distincData.indexOf(e.msgId) <0){\n                                        e.content = JSON.parse(e.content);\n                                        that.data.push(e)\n                                        that.distincData.push(e.msgId);\n                                        // 收到新消息，判断高度，如果当前滚动条高度距底部小于100，则动滑到底部\n                                        let chatform = document.getElementById(\"chatform\");\n                                        let gap = chatform.scrollHeight -chatform.scrollTop;\n                                        if(gap >0 && gap < 400){\n                                            this.scrollToBottom();\n                                        }\n                                    }\n                                });\n                                that.reloadData();\n                            }\n                        });\n                    },1000*2);\n                }\n\n            },\n            cancel(){ // 关闭窗体需要把提示任务开关一起关闭调\n                this.chatVisible = false;\n                this.timerSwitch = 0;\n            }\n        },\n        mounted() {\n        }\n    };\n</script>\n\n\n<style scoped>\n  .message {\n    height: 350px;\n  }\n  .ivu-card-body {\n    padding:5px;\n  }\n  .ivu-modal-body{\n    padding: 0px 16px 16px  16px;\n  }\n  .chat-message-body {\n    background-color:#F8F8F6;\n    width:545px;\n    height: 350px;\n    overflow: auto;\n  }\n  .message-card {\n    margin:5px;\n  }\n  .message-row-left {\n    display: flex;\n    flex-direction:row;\n  }\n  .message-row-right {\n    display: flex;\n    flex-direction:row-reverse;\n  }\n  .message-content {\n    margin:-5px 5px 5px 5px;\n    display: flex;\n    flex-direction:column;\n  }\n  .message-body {\n    border:1px solid #D9DAD9;\n    padding:5px;\n    border-radius:3px;\n    background-color:#FFF;\n  }\n  .message-time {\n    margin:0 5px;\n    font-size:5px;\n    color:#D9DAD9;\n  }\n  .footer-btn {\n    float:right;\n    margin-bottom: 5px;\n  }\n  .spin-icon-load {\n    animation:ani-spin 1s linear infinite;\n  }\n  @keyframes ani-spin{\n    form{transform: rotate(0deg);}\n    50% {transform: rotate(180deg);}\n    to  {transform: rotate(360deg);}\n  }\n</style>\n"]}]}